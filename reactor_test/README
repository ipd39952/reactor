# How to run tests
---
    bundle exec rake spec


# How to setup test environment

For testing we need a running Fiona-CMS.
You can use existing CMS-installation with a new instance or setup new Virtual Box
with comletely new CMS-installation.

How to install CMS: [https://kb.infopark.com/installation-5da6801a466b2f0c]

Create DB for CMS-Installation: connect to you mysql server and run following:

    CREATE DATABASE reactor_test;
    GRANT ALL PRIVILEGES ON reactor_user.* TO 'bima_proj_usr'@'%' IDENTIFIED BY 'reactor_user' WITH GRANT OPTION;
    CREATE DATABASE reactor_test_ugd;
    GRANT ALL PRIVILEGES ON reactor_test_ugd.* TO 'bima_proj_usr'@'%' IDENTIFIED BY 'reactor_test_ugd' WITH GRANT OPTION;
    FLUSH PRIVILEGES;


Yo have created two databases used for tests.


instance/<INSTANCE_NAME>/config/cmdb.xml
  <?xml version="1.0"?>
  <configuration>
      <adaptor>mysql</adaptor>
      <server>__SERVER_NAME__</server>
      <database>reactor_test</database>
      <user>reactor_user</user>
      <password>reactor_user</password>
      <port>3306</port>
      <!-- You must NOT change the value for 'storeBlobsInDatabase' after you have
          executed the application for the first time. If you do so you *will*
          lose data. -->
      <storeBlobsInDatabase>true</storeBlobsInDatabase>
  </configuration>


instance/<INSTANCE_NAME>/config/rc.npsd.conf

  set base [file join [pwd] [file dirname [info script]] ../../../]
  set conf(triforkHome) "/fiona/trifork-4.1.40"
  if {![file isdirectory $conf(triforkHome)]} {
      set conf(triforkHome) "/fiona/trifork-4.1.40"
  }
  set conf(triforkUser) administrator
  set conf(triforkPassword) trifork
  set conf(triforkJsr77HostAndPort) localhost:8070
  set conf(triforkArgs) [list server start -vmargs=-server\
          -vmargs=-Xmx512m -vmargs=-Xms256m\
          -vmargs=-XX:MaxPermSize=128m]
  if {[info exists ::env(TRIFORK_DEVEL_ARGS_APPEND)]} {
      eval lappend conf(triforkArgs) $::env(TRIFORK_DEVEL_ARGS_APPEND)
  }
  set conf(apps) [list CM]
  set conf(webApps) [list]
  set conf(webAppSuffix) ""

instance/<INSTANCE_NAME>/config/indexing.xml

Change `<isActive>true</isActive>` to `<isActive>false</isActive>`




After installation you should configure the reactor connection.

## 1: DB configuration

database.yml
  cms: &cms
    adapter: mysql2
    database: reactor_test
    username: reactor_user
    password: reactor_user
    host: 127.0.0.1 # PUT YOUR HOST HERE
    reconnect: true

  test:
    <<: *cms

  production:
    <<: *cms

  development:
    #<<: *cms
    adapter: mysql2
    database: reactor_test_ugd
    username: reactor_test_ugd
    password: reactor_test_ugd
    host: 127.0.0.1 # PUT YOUR HOST HERE
    reconnect: true



## 2: XML-connection

config/initializers/reactor.rb

  Reactor::Configuration.xml_access = {
    :host => '<YOUR_HOST>', # Fiona host
    :port => 3002, # CM http port (TCL port + 1). You can find the port in
                   # file config/serrver.xml under server/cm/httpPort in
                   # installtion directory of you CMS-instance
    :id => '1234', # leave it as is
    :username => 'root', # default user for all requests. Do not change
    :secret => 'MYSECRET' # instance secret!. Do not change
  }
